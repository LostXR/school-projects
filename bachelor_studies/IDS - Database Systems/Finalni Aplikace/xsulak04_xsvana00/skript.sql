DROP TABLE CITATEL CASCADE CONSTRAINTS;
DROP TABLE REZERVACIA CASCADE CONSTRAINTS;
DROP TABLE AUTOR CASCADE CONSTRAINTS;
DROP TABLE TITUL CASCADE CONSTRAINTS;
DROP TABLE ZAMESTNANEC CASCADE CONSTRAINTS;
DROP TABLE POZICKA CASCADE CONSTRAINTS;
DROP TABLE VYTISK CASCADE CONSTRAINTS;
--pridano
DROP TABLE AUTOR_TITUL;

CREATE TABLE CITATEL (
  ID NUMBER NOT NULL,
  MENO VARCHAR2 (25) NOT NULL,
  PRIEZVISKO VARCHAR2 (25) NOT NULL,
  ADRESA VARCHAR2 (50) NOT NULL,
  LOGIN VARCHAR2 (25) NOT NULL,
  HESLO VARCHAR2 (25) NOT NULL,
  TELEFON VARCHAR2 (25) NOT NULL,
  EMAIL VARCHAR2 (25) NOT NULL
);

CREATE TABLE REZERVACIA (
  ID_CITATELA NUMBER NOT NULL,
  ID_TITUL NUMBER NOT NULL,
  DATUM VARCHAR2 (50) NOT NULL,
  STAV VARCHAR2 (1) DEFAULT 'N' NOT NULL
);

CREATE TABLE AUTOR (
  ID NUMBER NOT NULL,
  MENO VARCHAR2 (25) NOT NULL,
  PRIEZVISKO VARCHAR2 (25) NOT NULL,
  DATUM_NARODENIA VARCHAR2 (50) NOT NULL,
  DATUM_UMRTIA VARCHAR2 (50),
  ZANER VARCHAR2 (25) NOT NULL
  );
--titul- pridan nazev, zmenen rok
CREATE TABLE TITUL (
  ID NUMBER NOT NULL,
  NAZEV VARCHAR2 (100) NOT NULL,
  ROK_VYDANIA NUMBER NOT NULL,
  ISBN VARCHAR2 (25) NOT NULL,
  CENA NUMBER NOT NULL,
  NAKLADATELSTVO VARCHAR2 (50) NOT NULL
);
--pridano
CREATE TABLE AUTOR_TITUL (
  ID_AUTOR NUMBER NOT NULL,
  ID_TITUL NUMBER NOT NULL
);

CREATE TABLE ZAMESTNANEC (
  ID NUMBER NOT NULL,
  MENO VARCHAR2 (25) NOT NULL,
  PRIEZVISKO VARCHAR2 (25) NOT NULL,
  ADRESA VARCHAR2 (50) NOT NULL,
  LOGIN VARCHAR2 (25) NOT NULL,
  HESLO VARCHAR2 (25) NOT NULL,
  TELEFON VARCHAR2 (25) NOT NULL,
  EMAIL VARCHAR2 (25) NOT NULL
  );

CREATE TABLE POZICKA (
  ID_CITATELA NUMBER NOT NULL,
  ID_EXEMPLAR NUMBER NOT NULL,
  DATUM_POZICANIA VARCHAR2 (50) NOT NULL,
  DATUM_SKUTOCNEHO_VRATENIA VARCHAR2 (50),
  STAV VARCHAR(20) DEFAULT 'Nevratene'
);

CREATE TABLE VYTISK (
  ID NUMBER NOT NULL,
  ID_TITUL NUMBER NOT NULL,
  DOSTUPNOST VARCHAR2 (1) DEFAULT 'A' NOT NULL
);


ALTER TABLE CITATEL ADD CONSTRAINT PK_CITATEL PRIMARY KEY (ID);
ALTER TABLE AUTOR ADD CONSTRAINT PK_AUTOR PRIMARY KEY (ID);
ALTER TABLE VYTISK ADD CONSTRAINT PK_VYTISK PRIMARY KEY (ID);
ALTER TABLE TITUL ADD CONSTRAINT PK_TITUL PRIMARY KEY (ID);
ALTER TABLE ZAMESTNANEC ADD CONSTRAINT PK_ZAMESTNANEC PRIMARY KEY (ID);

ALTER TABLE REZERVACIA ADD CONSTRAINT FK_CITATEL_R FOREIGN KEY(ID_CITATELA) REFERENCES CITATEL;
ALTER TABLE REZERVACIA ADD CONSTRAINT FK_TITUL_R FOREIGN KEY(ID_TITUL) REFERENCES TITUL;
ALTER TABLE POZICKA ADD CONSTRAINT FK_CITATEL_P FOREIGN KEY(ID_CITATELA) REFERENCES CITATEL;
ALTER TABLE POZICKA ADD CONSTRAINT FK_VYTISK FOREIGN KEY(ID_EXEMPLAR) REFERENCES VYTISK;
ALTER TABLE VYTISK ADD CONSTRAINT FK_TITUL_V FOREIGN KEY(ID_TITUL) REFERENCES TITUL;
--pridano
ALTER TABLE AUTOR_TITUL ADD CONSTRAINT FK_AUTOR FOREIGN KEY(ID_AUTOR) REFERENCES AUTOR;
ALTER TABLE AUTOR_TITUL ADD CONSTRAINT FK_TITUL_AT FOREIGN KEY(ID_TITUL) REFERENCES TITUL;

INSERT INTO CITATEL (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('01', 'Laco', 'Neviem', 'Bozetechova 2, Brno', 'xnevie00', '123456', '+421902252390', 'l.neviem@gmail.com');
INSERT INTO CITATEL (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('02', 'Peto', 'Nepoviem' , 'Bozetechova 3, Brno', 'xnepov00', '654321', '+421502252390', 'nepoviem@gmail.com');
INSERT INTO CITATEL (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('03', 'Ivan', 'Tajny', 'Bozetechova 4, Brno', 'xtajny00', '456321', '+421902252399', 'tajny@gmail.com');
INSERT INTO CITATEL (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('04', 'Bonifac', 'Kazisvetsky', 'Nastupiste 9 a 3/4, Kocurkovo', 'xkazis00', '954214', '+421902256390', 'kazisvet@gmail.com');
INSERT INTO CITATEL (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('05', 'Servac', 'Neznamy', 'Bozetechova 654, Brno', 'xneznam00', '987654', '+421902253390', 'neznamy@gmail.com');
 -- TITUL : pridan nazev, upraveny format roku
INSERT INTO TITUL (ID, NAZEV, ROK_VYDANIA, ISBN, CENA, NAKLADATELSTVO) VALUES('01', '20 000 nedel v balonu', '1853', '978-80-7357-984-5', '951', 'Motyl');
INSERT INTO TITUL (ID, NAZEV, ROK_VYDANIA, ISBN, CENA, NAKLADATELSTVO) VALUES('02', 'Vinnetou - Zombiefest', '1887', '978-80-7357-134-7', '97', 'Pelikan');
INSERT INTO TITUL (ID, NAZEV, ROK_VYDANIA, ISBN, CENA, NAKLADATELSTVO) VALUES('03', 'Pribeh dementniho programatora', '2014', '978-30-7657-784-9', '21', 'Albatros');
INSERT INTO TITUL (ID, NAZEV, ROK_VYDANIA, ISBN, CENA, NAKLADATELSTVO) VALUES('04', 'Jak spravne na projekt do predmetu IFJ', '2013', '978-10-7957-983-3', '9', 'Gitary.cz');
INSERT INTO TITUL (ID, NAZEV, ROK_VYDANIA, ISBN, CENA, NAKLADATELSTVO) VALUES('05', 'Varime brambory tim spravnym stylem', '2014', '978-70-7307-904-5', '51', 'Motyl');

INSERT INTO REZERVACIA (ID_CITATELA, ID_TITUL, DATUM, STAV) VALUES('01', '01', '22/DEC/2013', 'A');
INSERT INTO REZERVACIA (ID_CITATELA, ID_TITUL, DATUM, STAV) VALUES('02', '02', '12/DEC/2013', 'N');
INSERT INTO REZERVACIA (ID_CITATELA, ID_TITUL, DATUM) VALUES('03', '03', '21/JAN/2013' );
INSERT INTO REZERVACIA (ID_CITATELA, ID_TITUL, DATUM) VALUES('04', '04', '20/FEB/2013' );
INSERT INTO REZERVACIA (ID_CITATELA, ID_TITUL, DATUM, STAV) VALUES('05', '05', '03/NOV/2013', 'A');

INSERT INTO AUTOR (ID, MENO, PRIEZVISKO, DATUM_NARODENIA, DATUM_UMRTIA, ZANER) VALUES('01', 'Jules', 'Verne', '08/FEB/1828', '24/MAR/1905', 'BALADY');
INSERT INTO AUTOR (ID, MENO, PRIEZVISKO, DATUM_NARODENIA, DATUM_UMRTIA, ZANER) VALUES('02', 'Mladoslav', 'Ahojky', '08/FEB/1828', '24/MAR/1905', 'SCI-FI');
INSERT INTO AUTOR (ID, MENO, PRIEZVISKO, DATUM_NARODENIA, DATUM_UMRTIA, ZANER) VALUES('03', 'Ladislav', 'Sulak', '25/FEB/1842', '30/MAR/1912', 'ROZPRAVKY');
INSERT INTO AUTOR (ID, MENO, PRIEZVISKO, DATUM_NARODENIA, DATUM_UMRTIA, ZANER) VALUES('04', 'Karl', 'May', '25/FEB/1842', '30/MAR/1912', 'western');
INSERT INTO AUTOR (ID, MENO, PRIEZVISKO, DATUM_NARODENIA, DATUM_UMRTIA, ZANER) VALUES('05', 'Petr', 'Svana', '01/APR/1313', '01/APR/2222', 'apokalypsa');

INSERT INTO ZAMESTNANEC (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('01', 'Servac', 'Necitam', 'Bozetechova 20, Brno', 'xnecita00', '980121', '+421902552390', 's.necitam@gmail.com');
INSERT INTO ZAMESTNANEC (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('02', 'Ignac', 'Knihomol', 'Bozetechova 25, Brno', 'xknihom00', '123asd', '+421902252390', 'i.kniha@gmail.com');
INSERT INTO ZAMESTNANEC (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('03', 'Bonicac', 'Ozembradsky', 'Bozetechova 27, Brno', 'xozembr00', 'asddfh', '+421902212390', 'b.ozembradsky@gmail.com');
INSERT INTO ZAMESTNANEC (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('04', 'Juhoslav', 'Sikovny', 'Bozetechova 29, Brno', 'xjuhosl00', 'qfbnbc', '+421902272390', 'j.sikovny@gmail.com');
INSERT INTO ZAMESTNANEC (ID, MENO, PRIEZVISKO, ADRESA, LOGIN, HESLO, TELEFON, EMAIL) VALUES('05', 'Servoslav', 'Tabulkovy', 'Bozetechova 23, Brno', 'xtabul00', 'piuytr', '+421902202390', 's.servoslav@gmail.com');

INSERT INTO VYTISK (ID, ID_TITUL, DOSTUPNOST) VALUES('01', '01', 'A');
INSERT INTO VYTISK (ID, ID_TITUL, DOSTUPNOST) VALUES('02', '05', 'N');
INSERT INTO VYTISK (ID, ID_TITUL, DOSTUPNOST) VALUES('03', '04', 'A');
INSERT INTO VYTISK (ID, ID_TITUL, DOSTUPNOST) VALUES('04', '03', 'N');
INSERT INTO VYTISK (ID, ID_TITUL, DOSTUPNOST) VALUES('06', '03', 'N');
INSERT INTO VYTISK (ID, ID_TITUL) VALUES('05', '02');

INSERT INTO POZICKA (ID_CITATELA, ID_EXEMPLAR, DATUM_POZICANIA, DATUM_SKUTOCNEHO_VRATENIA, STAV) VALUES('01', '05', '28/NOV/1999', '28/NOV/2000', 'Vratene');
INSERT INTO POZICKA (ID_CITATELA, ID_EXEMPLAR, DATUM_POZICANIA, DATUM_SKUTOCNEHO_VRATENIA, STAV) VALUES('02', '04', '12/DEC/1998', '12/DEC/1999', 'Vratene');
INSERT INTO POZICKA (ID_CITATELA, ID_EXEMPLAR, DATUM_POZICANIA, DATUM_SKUTOCNEHO_VRATENIA, STAV) VALUES('03', '01', '02/FEB/2003', '02/FEB/2004', 'Vratene');
INSERT INTO POZICKA (ID_CITATELA, ID_EXEMPLAR, DATUM_POZICANIA, DATUM_SKUTOCNEHO_VRATENIA, STAV) VALUES('04', '03', '12/NOV/2001', '12/NOV/2002', 'Vratene');
INSERT INTO POZICKA (ID_CITATELA, ID_EXEMPLAR, DATUM_POZICANIA) VALUES('05', '02', '23/APR/2010');
--vazebni tabulka
INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('01', '01'); 
--Jules Verne(01) je jediny autor 20 000 nedel v balonu(01)

INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('04', '02'); 
--Karl May(04) je jediny autor Vinnetou - Zombiefest(02)

INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('02', '03'); 
--Mladoslav Ahojky (02) je jediny autor Pribeh dementniho programatora (03)

INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('03', '04'); 
INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('05', '04'); 
--Petr Svana (05)a Ladislav Sulak(03) jsou autori Jak spravne na projekt do predmetu IFJ(04)

INSERT INTO AUTOR_TITUL (ID_AUTOR, ID_TITUL) VALUES('05', '05'); 
--Petr Svana (05)je jediny autor Varime brambory tim spravnym stylem


--trigger-
CREATE OR REPLACE TRIGGER smaz_vytisk
BEFORE DELETE ON vytisk
BEGIN
  DELETE FROM pozicka WHERE pozicka.id_exemplar = id_exemplar;
END smaz_vytisk;
/


--index - pre zrychlenie vyhladavania podla urcitych klucov
CREATE INDEX INDEX_TITUL ON TITUL (NAZEV);
CREATE INDEX INDEX_CITATEL ON CITATEL (PRIEZVISKO);


--procedura pre zmazanie konkretneho titulu, udaneho menom v parametri
--mimo jine smaze veskere zminky, ze zadana kniha kdy existovala (ve spolupraci s triggerem)
CREATE OR REPLACE procedure VYMAZ_TITUL (ID NUMBER)
IS
BEGIN
  DELETE FROM autor_titul
  WHERE autor_titul.id_titul = VYMAZ_TITUL.ID;
  DELETE FROM rezervacia
  WHERE rezervacia.id_titul = VYMAZ_TITUL.ID;
  DELETE FROM vytisk
  WHERE vytisk.id_titul = vymaz_titul.ID;
	DELETE FROM TITUL
	WHERE TITUL.ID = VYMAZ_TITUL.ID;
END;
/


--Pristupove prava pre druheho uzivatela
GRANT ALL ON TITUL TO xsvana00;